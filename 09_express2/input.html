<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Expressデータ送信</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body>
  <div class="container">
    <div class="mt-3 mb-3">
      <h2 class="h2">Express データ送信</h2>
      <p class="alert alert-info">
        Express のサーバーを http://localhost:3000 で起動し、このフォームから jQuery で POST リクエストします。
        リクエスト URL は http://localhost:3000?id=123 としています。
      </p>
    </div>

    <div class="row">

      <div class="col-6">
        <div class="card">
          <div class="card-header">
            <h3 class="h3">レスポンス</h3>
          </div>
          <div class="card-body">
            <p id="result">Express からレスポンスがあると ここに表示されます。</p>
          </div>
        </div>
      </div>

      <div class="col-6">
      <form id="form" method="post">
        <div class="input-group-prepend">
          <input class="form-control" type="text" name="message">
          <input class="btn btn-primary w-25" type="submit" value="送信">
        </div>
      </form>
        <div class="card">
          <div class="card-header">
            <h3 class="h3">履歴</h3>
          </div>
          <div class="card-body">
            <div class="text-right">
              <a id="clearBtn" class="btn btn-sm btn-outline-primary">クリア</a>
            </div>
            <div id="history"></div>
          </div>
        </div>
      </div>

    </div>

    <script>
      $(function () {
        //履歴削除
        $('#clearBtn').on('click', function () {
          $('#history').text('');
        });

        //フォームリクエスト
        $('#form').on('submit', function () {
          //HTML フォームを止める
          event.preventDefault();

          //Ajax データ送信
          let data = $('#form').serialize();
          const url = 'http://localhost:3000?id=123';

          console.log(data);
          $.ajax({
            url: url,
            type: 'post',
            data: data,
            dataType: 'text'
          }).done(function (res) {
            //結果
            console.debug(res);
            $('#result').text(res);

            //履歴
            const result = JSON.parse(res);
            const date = new Date(result.datetime);
            const date_string = date.toLocaleString('ja-JP');
            const message = `${date_string} ${result.message}`;

            const div = $('<div>');
            div.append(message);
            $('#history').append(div);
          }).fail(function (xhr, status, error) {
            //エラー
            alert(status);
          });
        });

      });
    </script>
</body>

</html>